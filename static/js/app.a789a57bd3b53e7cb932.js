webpackJsonp([2],{"+skl":function(e,s){},"0/qO":function(e,s,t){"use strict";var r={name:"PanelLeft",props:["usersList","allUsersList","userInfo","userIndex"],data:function(){return{tabSelected:"tab1",selected:-1}},watch:{userIndex:function(e,s){this.selected=e,this.$emit("userSelected",this.selected)}},methods:{infoAct:function(e){switch(e){case"logout":sessionStorage.removeItem("user"),window.location.reload();break;case"memberManage":case"passwd":this.$emit("actionLeft",e)}},selectAllUser:function(e,s){for(var t in this.tabSelected="tab1",this.usersList)if(this.usersList[t].name==e.name)return this.selected=parseInt(t),void this.$emit("userSelected",t);this.$emit("allUserSelected",e),this.selected=0},selectUser:function(e,s){this.selected=s,this.$emit("actionLeft","userIndex",s),this.$emit("userSelected",s)},userListSwitch:function(e){}}},a={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{attrs:{id:"panel-left"}},[t("div",{staticClass:"header"},[t("Avatar",{staticStyle:{color:"#f8f8f9","background-color":"#19be6b"},attrs:{shape:"square",size:"large"}},[e._v("\n            "+e._s("string"==typeof e.userInfo.name?e.userInfo.name.substr(0,1):"")+"\n        ")]),e._v(" "),t("div",{staticClass:"info"},[t("span",[e._v(e._s((e.userInfo.name,e.userInfo.name)))]),e._v(" "),t("Dropdown",{staticClass:"info-act",attrs:{trigger:"click",placement:"bottom-end"},on:{"on-click":e.infoAct}},[t("a",{attrs:{href:"javascript:void(0)"}},[t("Icon",{attrs:{type:"md-menu",size:"26"}})],1),e._v(" "),t("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e.userInfo.manager?t("DropdownItem",{attrs:{name:"memberManage"}},[e._v("人员管理")]):e._e(),e._v(" "),t("DropdownItem",{attrs:{divided:"",name:"passwd"}},[e._v("修改密码")]),e._v(" "),t("DropdownItem",{attrs:{name:"logout"}},[e._v("退出")])],1)],1)],1),e._v(" "),t("div",{staticClass:"search",staticStyle:{display:"none"}},[t("Input",{attrs:{type:"text",placeholder:""}},[t("Icon",{attrs:{slot:"prepend",type:"ios-search"},slot:"prepend"})],1)],1)],1),e._v(" "),t("Tabs",{staticClass:"userlist-tab",on:{"on-click":e.userListSwitch},model:{value:e.tabSelected,callback:function(s){e.tabSelected=s},expression:"tabSelected"}},[t("TabPane",{attrs:{label:"会话列表",name:"tab1",icon:"ios-chatbubbles"}},[t("CellGroup",e._l(e.usersList,function(s,r){return t("div",{on:{click:function(t){return e.selectUser(s,r)}}},[t("Cell",{class:{selected:e.selected==r}},[t("div",{staticClass:"avatar",staticStyle:{display:"inline"}},[s.group?e._e():t("Avatar",{attrs:{icon:"ios-person"}}),e._v(" "),s.group?t("Avatar",{attrs:{icon:"ios-people"}}):e._e()],1),e._v(" "),t("div",{staticStyle:{display:"inline"}},[t("span",[e._v(e._s(s.name))])]),e._v(" "),t("Badge",{attrs:{slot:"extra",count:s.unread},slot:"extra"})],1)],1)}),0)],1),e._v(" "),t("TabPane",{attrs:{label:"人员列表",name:"tab2",icon:"ios-contact"}},[t("CellGroup",e._l(e.allUsersList,function(s,r){return e.userInfo.name!=s.name?t("div",{on:{click:function(t){return e.selectAllUser(s,r)}}},[t("Cell",{},[t("div",{staticClass:"avatar",staticStyle:{display:"inline"}},[t("Avatar",{attrs:{icon:"ios-person"}})],1),e._v(" "),t("div",{staticStyle:{display:"inline"}},[t("span",[e._v(e._s(s.name))])]),e._v(" "),t("Badge",{attrs:{slot:"extra",count:s.unread},slot:"extra"})],1)],1):e._e()}),0)],1)],1)],1)},staticRenderFns:[]};var n=t("VU/8")(r,a,!1,function(e){t("8eiH")},null,null);s.a=n.exports},"8eiH":function(e,s){},Kzu5:function(e,s,t){"use strict";var r={name:"PanelMain",props:["user","userInfo"],watch:{"user.content":function(){var e=this;this.$nextTick(function(){setTimeout(function(){var s=e.$el.querySelector(".chat-main");s.scrollTop=s.scrollHeight},15)})}},methods:{dateFormat:{dateFormat:function(e){var s=new Date(1e3*e),t=s.getFullYear(),r=s.getMonth()+1;r=r<10?"0"+r:r;var a=s.getDate();a=a<10?"0"+a:a;var n=s.getHours();n=n<10?"0"+n:n;var i=s.getMinutes();i=i<10?"0"+i:i;var o=s.getSeconds();return t+"-"+r+"-"+a+" "+n+":"+i+":"+(o=o<10?"0"+o:o)}}.dateFormat,sendMsg:function(){""!=this.msg.trim()&&(this.$emit("sendMsg",this.msg,{type:"txt"}),this.msg="")},uploadSuccess:function(e,s,t){var r=e[uploadConfig.urlKey],a=s.name,n=a.lastIndexOf("."),i=a.substr(n+1),o=!1;-1!==["png","jpg","jpeg","bmp","gif","webp","psd","svg","tiff"].indexOf(i.toLowerCase())&&(o=!0),this.$emit("sendMsg",r,{type:o?"img":"file",name:a})},chatAct:function(e){switch(e){case"memberSearch":this.$emit("actionMain","memberSearch");break;case"delConversation":this.$emit("actionMain",e)}},face:function(e){this.face_show=!1;var s=e.currentTarget.innerHTML;this.msg=this.msg+s},msgBr:function(){this.msg+="\n"}},data:function(){return{uploadUrl:uploadConfig.url,showMembers:!1,msg:"",face_show:!1}}},a={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{attrs:{id:"panel-main"}},[t("div",{staticClass:"chat-title"},[e.user.group?e._e():t("span",{staticClass:"users-list"},[e._v(e._s(e.user.name))]),e._v(" "),e.user.group?t("div",{staticClass:"users-list"},[t("a",{attrs:{href:"javascript:void(0)",size:"26"},on:{click:function(s){e.showMembers=!e.showMembers}}},[e._v("\r\n                "+e._s(e.user.name)+" "+e._s(e.user.members.length)+"人\r\n                "),e.user.group?t("Icon",{attrs:{type:"ios-arrow-down"}}):e._e()],1),e._v(" "),e.showMembers?t("div",{staticClass:"members"},e._l(e.user.members,function(s){return t("div",{staticClass:"user"},[t("Avatar",{attrs:{icon:"ios-person"}}),e._v(" "),t("p",[e._v(e._s(s.name))])],1)}),0):e._e()]):e._e(),e._v(" "),0!==Object.keys(e.user).length?t("Dropdown",{staticClass:"chat-act",attrs:{trigger:"click",placement:"bottom-end"},on:{"on-click":e.chatAct}},[t("a",{attrs:{href:"javascript:void(0)"}},[t("Icon",{attrs:{type:"md-more",size:"26"}})],1),e._v(" "),t("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t("DropdownItem",{attrs:{name:"delConversation"}},[e._v(e._s(e.user.group?"退出群聊":"删除会话"))]),e._v(" "),t("DropdownItem",{attrs:{divided:"",name:"memberSearch"}},[e._v(e._s(e.user.group?"拉人入群":"发起群聊"))])],1)],1):e._e()],1),e._v(" "),t("div",{staticClass:"chat-body"},[t("div",{staticClass:"chat-main"},[t("ul",e._l(e.user.content,function(s){return t("li",{class:{"chat-mine":s.from===e.userInfo.name}},[t("div",{staticClass:"chat-user"},[t("Avatar",{attrs:{src:s.img,icon:"ios-person"}}),e._v(" "),t("p",[t("span",{staticClass:"msg_from"},[e._v(e._s(s.from))]),t("span",{staticClass:"msg_time"},[e._v(e._s(e.dateFormat(s.time)))])])],1),e._v(" "),"txt"==s.type?t("div",{staticClass:"chat-text",domProps:{innerHTML:e._s(s.msg.replace(/\n/g,"<br />"))}}):e._e(),e._v(" "),"txt"!=s.type?t("div",{staticClass:"chat-text"},["img"===s.type?t("a",{attrs:{href:s.msg,target:"_blank"}},[t("img",{staticClass:"timg",attrs:{src:s.msg}})]):e._e(),e._v(" "),"file"===s.type?t("a",{staticStyle:{color:"white"},attrs:{href:s.msg}},[t("Icon",{attrs:{type:"md-copy",size:"40",color:"#515a6e"}}),e._v(" "),t("span",[e._v(e._s(s.filename))])],1):e._e()]):e._e()])}),0)])]),e._v(" "),0!==Object.keys(e.user).length?t("div",{staticClass:"chat-bottom"},[t("Row",[t("Col",{attrs:{span:"2"}},[t("Upload",{attrs:{"show-upload-list":!1,"on-success":e.uploadSuccess,action:e.uploadUrl}},[t("Icon",{attrs:{type:"md-copy",size:"26"}})],1)],1),e._v(" "),t("Col",{attrs:{span:"2"}},[e.face_show?t("div",{staticClass:"face-box",on:{mouseleave:function(s){e.face_show=!1}}},[t("ul",e._l(20,function(s){return t("li",{domProps:{innerHTML:e._s("&#"+(128512+s)+";")},on:{click:e.face}})}),0)]):e._e(),e._v(" "),t("Icon",{attrs:{type:"md-happy",size:"26"},nativeOn:{mouseover:function(s){e.face_show=!0}}})],1)],1),e._v(" "),t("div",[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.msg,expression:"msg"}],staticClass:"ivu-input",attrs:{rows:"3"},domProps:{value:e.msg},on:{keyup:[function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:s.ctrlKey||s.shiftKey||s.altKey||s.metaKey?null:e.sendMsg()},function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:s.ctrlKey?e.msgBr():null}],input:function(s){s.target.composing||(e.msg=s.target.value)}}})]),e._v(" "),t("Button",{staticStyle:{float:"right","margin-top":"5px"},attrs:{type:"primary"},on:{click:function(s){return e.sendMsg()}}},[e._v("\r\n            发送 "),t("Icon",{attrs:{type:"ios-paper-plane",size:14}})],1)],1):e._e()])},staticRenderFns:[]};var n=t("VU/8")(r,a,!1,function(e){t("z1pM")},null,null);s.a=n.exports},M20z:function(e,s,t){"use strict";var r={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var e=this.$createElement,s=this._self._c||e;return s("div",{attrs:{id:"panel-right"}},[s("span",[this._v("Panel Left")])])}]};var a=t("VU/8")({name:"PanelLeft"},r,!1,function(e){t("iSJe")},null,null);s.a=a.exports},M93x:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=t("xJD8"),a={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticStyle:{"background-color":"#fff"},attrs:{id:"app"}},[t("Row",{staticClass:"wrapper"},[t("Col",{attrs:{span:"7"}},[t("panel-left",{attrs:{"user-info":e.userInfo,"users-list":e.usersList,"all-users-list":e.allUsersList,userIndex:e.userIndex},on:{actionLeft:e.actionLeft,allUserSelected:e.allUserSelected,userSelected:e.userSelected}})],1),e._v(" "),t("Col",{attrs:{span:"17"}},[t("panel-main",{attrs:{user:e.user,userInfo:e.userInfo},on:{actionMain:e.actionMain,sendMsg:e.sendMsg}})],1)],1),e._v(" "),t("Modal",{attrs:{title:"请登录",closable:!1,"mask-closable":!1},model:{value:0===Object.keys(e.userInfo).length,callback:function(s){e.$set(Object.keys(e.userInfo),"length === 0",s)},expression:"Object.keys(userInfo).length === 0"}},[t("Form",{ref:"formLogin",attrs:{model:e.formLogin,rules:e.formLogin.rule,inline:""}},[t("FormItem",{attrs:{prop:"user"}},[t("Input",{attrs:{type:"text",placeholder:"Username"},model:{value:e.formLogin.user,callback:function(s){e.$set(e.formLogin,"user",s)},expression:"formLogin.user"}},[t("Icon",{attrs:{slot:"prepend",type:"ios-person-outline"},slot:"prepend"})],1)],1),e._v(" "),t("FormItem",{attrs:{prop:"password"}},[t("Input",{attrs:{type:"password",placeholder:"Password"},model:{value:e.formLogin.password,callback:function(s){e.$set(e.formLogin,"password",s)},expression:"formLogin.password"}},[t("Icon",{attrs:{slot:"prepend",type:"ios-lock-outline"},slot:"prepend"})],1)],1)],1),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{size:"large"},on:{click:function(s){return e.formLoginSubmit("formLogin")}}},[e._v("登录")])],1)],1),e._v(" "),t("Modal",{attrs:{title:"密码修改",closable:!1},model:{value:e.formPasswd.show,callback:function(s){e.$set(e.formPasswd,"show",s)},expression:"formPasswd.show"}},[t("Form",{ref:"formPasswd",attrs:{model:e.formPasswd,rules:e.formPasswd.rule,inline:""}},[t("FormItem",{attrs:{prop:"passwd"}},[t("Input",{attrs:{type:"password",placeholder:"旧密码"},model:{value:e.formPasswd.passwd,callback:function(s){e.$set(e.formPasswd,"passwd",s)},expression:"formPasswd.passwd"}},[t("Icon",{attrs:{slot:"prepend",type:"ios-lock-outline"},slot:"prepend"})],1)],1),e._v(" "),t("FormItem",{attrs:{prop:"passwd2"}},[t("Input",{attrs:{type:"password",placeholder:"新密码"},model:{value:e.formPasswd.passwd2,callback:function(s){e.$set(e.formPasswd,"passwd2",s)},expression:"formPasswd.passwd2"}},[t("Icon",{attrs:{slot:"prepend",type:"ios-lock-outline"},slot:"prepend"})],1)],1)],1),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{size:"large"},on:{click:function(s){return e.formLoginSubmit("formPasswd")}}},[e._v("确定")])],1)],1),e._v(" "),t("Modal",{attrs:{title:"人员管理"},model:{value:e.memberManage.show,callback:function(s){e.$set(e.memberManage,"show",s)},expression:"memberManage.show"}},[t("Form",{ref:"formUpdateUser",attrs:{model:e.formLogin,rules:e.formLogin.rule,inline:""}},[t("FormItem",{attrs:{prop:"user"}},[t("Input",{staticStyle:{width:"200px"},attrs:{type:"text",size:"default",placeholder:"Username"},model:{value:e.formLogin.user,callback:function(s){e.$set(e.formLogin,"user",s)},expression:"formLogin.user"}},[t("Icon",{attrs:{slot:"prepend",type:"ios-person-outline"},slot:"prepend"})],1)],1),e._v(" "),t("FormItem",{attrs:{prop:"password"}},[t("Input",{staticStyle:{width:"190px"},attrs:{type:"password",size:"default",placeholder:"Password"},model:{value:e.formLogin.password,callback:function(s){e.$set(e.formLogin,"password",s)},expression:"formLogin.password"}},[t("Icon",{attrs:{slot:"prepend",type:"ios-lock-outline"},slot:"prepend"})],1)],1),e._v(" "),t("FormItem",[t("Button",{attrs:{type:"primary",size:"default"},on:{click:function(s){return e.formLoginSubmit("formUpdateUser")}}},[e._v("添加")])],1)],1),e._v(" "),t("Table",{attrs:{size:"small",columns:e.memberManage.columns,data:e.memberManage.data}})],1),e._v(" "),t("Modal",{attrs:{title:"人员列表"},on:{"on-ok":e.memberSearchOk},model:{value:e.memberSearch.show,callback:function(s){e.$set(e.memberSearch,"show",s)},expression:"memberSearch.show"}},[[e.user.group?e._e():t("Input",{staticStyle:{"margin-bottom":"8px"},attrs:{placeholder:"群名称 创建后不可修改"},model:{value:e.memberSearch.group_name,callback:function(s){e.$set(e.memberSearch,"group_name",s)},expression:"memberSearch.group_name"}})],e._v(" "),t("Table",{attrs:{size:"small",columns:e.memberSearch.columns,data:e.memberSearch.data},on:{"on-selection-change":e.memberSearchSelected}})],2),e._v(" "),t("Modal",{attrs:{"footer-hide":!0,closable:!1,"mask-closable":!1,width:"320"},model:{value:e.ws_status,callback:function(s){e.ws_status=s},expression:"ws_status"}},[t("Spin"),t("span",{staticStyle:{color:"#ff9900",float:"left",margin:"-26px 0 0 60px","font-size":"15px"}},[e._v("服务器连接中...")])],1)],1)},staticRenderFns:[]};var n=function(e){t("cga9")},i=t("VU/8")(r.a,a,!1,n,null,null);s.default=i.exports},NHnr:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=t("7+uW"),a=t("M93x"),n=t("/ocq"),i={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"hello"})},staticRenderFns:[]};t("VU/8")({name:"Main",data:function(){return{msg:"Welcome to Your Vue.js App"}}},i,!1,null,null,null).exports;r.default.use(n.a);var o=new n.a({routes:[{path:"/",name:"App",component:function(e){return new Promise(function(e){e()}).then(function(){var s=[t("M93x")];e.apply(null,s)}.bind(this)).catch(t.oe)}},{path:"/login",name:"Login",component:t.e(0).then(function(){t("xJsL")}).catch(t.oe)}]}),_=t("BTaQ"),u=t.n(_);t("+skl");r.default.config.productionTip=!1,r.default.use(u.a,{transfer:!0,size:"large",select:{arrow:"md-arrow-dropdown",arrowSize:20}}),new r.default({el:"#app",router:o,components:{App:a.default},template:"<App/>"})},cga9:function(e,s){},fd8m:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default={update_user:function(e,s){if(!s.status)return e.$Message.error(s.msg);if(e.$Message.success(s.msg),e.formLogin.user="",e.formLogin.password="",s.data){if(1==typeof s.data.del)return void(e.memberManage.data=e.memberManage.data.filter(function(e){return e.name!=s.data.name}));for(var t in e.memberManage.data)if(e.memberManage.data[t].name==s.data.name)return;e.memberManage.data.push(s.data)}},user_list:function(e,s){if(0!=s.data.length)if(void 0!==s.data[0].online)e.allUsersList=s.data;else if(e.memberManage.data=s.data,void 0!==e.user.group){var t=[];if(e.user.group){var r=[];for(var a in e.user.members)r.push(e.user.members[a].name);for(var n in s.data)r.indexOf(s.data[n].name)>-1||t.push(s.data[n])}else for(var i in s.data)s.data[i].name!=e.user.name&&s.data[i].name!=e.userInfo.name&&t.push(s.data[i]);e.memberSearch.data=t}},join_group:function(e,s){if(1!=s.status)return e.$Message.error(s.msg);var t={name:s.group_name,img:"",unread:0,members:s.users,group:!0,content:[]};if(s.create){if(e.usersList.unshift(t),s.from==e.userInfo.name){if(0==e.userIndex)return void e.userSelected(0);e.userIndex=0}}else{for(var r in e.usersList)if(e.usersList[r].group&&e.usersList[r].name==s.group_name)return void(e.usersList[r].members=s.users);e.usersList.unshift(t)}s.from!=e.userInfo.name&&void 0!==e.user.name&&(e.userIndex+=1)},passwd:function(e,s){if(!s.status)return e.$Message.error(s.msg);e.$Message.success(s.msg),e.formPasswd.show=!1,e.formPasswd.passwd="",e.formPasswd.passwd2=""},warn:function(e,s){switch(e.$Message.error(s.msg),s.code){case 1:sessionStorage.removeItem("user"),e.userInfo={},e.ws.close(),setTimeout(function(){window.location.reload()},3500)}}}},iSJe:function(e,s){},xJD8:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__=__webpack_require__("fZjL"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_2__components_PanelLeft__=__webpack_require__("0/qO"),__WEBPACK_IMPORTED_MODULE_3__components_PanelMain__=__webpack_require__("Kzu5"),__WEBPACK_IMPORTED_MODULE_4__components_PanelRight__=__webpack_require__("M20z"),__WEBPACK_IMPORTED_MODULE_5__wsEvents__=__webpack_require__("fd8m");__webpack_require__("fd8m"),__webpack_exports__.a={name:"App",components:{PanelLeft:__WEBPACK_IMPORTED_MODULE_2__components_PanelLeft__.a,PanelMain:__WEBPACK_IMPORTED_MODULE_3__components_PanelMain__.a,PanelRight:__WEBPACK_IMPORTED_MODULE_4__components_PanelRight__.a},methods:{userSelected:function(e){e<0||e>this.usersList.length?this.user={}:(this.user=this.usersList[e],this.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()({type:"msg_list",group:this.user.group,from:this.user.name,to:this.userInfo.name})),this.user.unread>0&&this.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()({type:"mark_read",from:this.user.name,to:this.userInfo.name})),this.user.unread=0)},allUserSelected:function(e){this.usersList.unshift({name:e.name,group:!1,unread:0,last_time:9999999999,content:[]}),this.user=this.usersList[0]},formLoginSubmit:function(e){var s=this;this.$refs[e].validate(function(t){if(t)switch(e){case"formLogin":var r={type:"login",name:s.formLogin.user,passwd:s.formLogin.password};s.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(r));break;case"formUpdateUser":r={type:"update_user",name:s.formLogin.user,passwd:s.formLogin.password};s.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(r));break;case"formPasswd":r={type:"passwd",passwd:s.formPasswd.passwd,passwd2:s.formPasswd.passwd2,name:s.userInfo.name};s.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(r))}})},wsUpdateUser:function(e){},wsMsg:function wsMsg(evt){var msg=eval("("+evt.data+")");switch(msg.type){case"login":if(!msg.status)return this.$Message.error(msg.msg);this.$Message.success(msg.msg),this.formLogin.user="",this.formLogin.password="";var data=msg.data;delete data.passwd,this.userInfo=data,sessionStorage.setItem("user",__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(data)),this.afterLogin();break;case"friend_list":for(var i in msg.data)msg.data[i].content=[];this.usersList=msg.data;break;case"msg_list":this.user.content=msg.data;break;case"txt":case"img":case"file":if(msg.from!=this.userInfo.name)if(0===msg.to.indexOf("@"))if(msg.to.substr(1)!=this.user.name){for(var _i in this.usersList)if(this.usersList[_i].group&&this.usersList[_i].name==msg.to.substr(1)){this.usersList[_i].unread++;var _top=this.usersList[_i];this.usersList.splice(_i,1),this.usersList.unshift(_top),this.userIndex>=0&&this.userIndex<_i&&(this.userIndex+=1);break}}else this.user.content.push(msg);else if(1==msg.new_chat)this.usersList.unshift({name:msg.from,img:"",group:!1,unread:1,last_time:msg.time,content:[]}),void 0!==this.user.name&&(this.userIndex+=1);else if(msg.from!=this.user.name){for(var _i2 in this.usersList)if(this.usersList[_i2].name==msg.from){this.usersList[_i2].unread++,this.usersList[_i2].last_time=msg.time;var _top2=this.usersList[_i2];this.usersList.splice(_i2,1),this.usersList.unshift(_top2),this.userIndex>=0&&this.userIndex<_i2&&(this.userIndex+=1);break}}else this.user.last_time=msg.time,this.user.content.push(msg);else this.user.name!=msg.to&&this.user.name!=msg.to.substr(1)||(this.user.last_time=msg.time,this.user.content.push(msg));break;default:"function"==typeof __WEBPACK_IMPORTED_MODULE_5__wsEvents__.default[msg.type]&&__WEBPACK_IMPORTED_MODULE_5__wsEvents__.default[msg.type](this,msg)}},sendMsg:function(e,s){var t={type:"txt",from:this.userInfo.name,to:this.user.name,msg:e,name:this.userInfo.name};switch(s.type){case"txt":break;case"img":t.type="img";break;case"file":t.type="file",t.filename=s.name}this.user.group&&(t.to="@"+t.to),this.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(t))},actionLeft:function(e,s){switch(e){case"memberManage":this.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()({type:"user_list"})),this.memberManage.show=!0;break;case"passwd":this.formPasswd.show=!0;break;case"userIndex":this.userIndex=s}},afterLogin:function(){var e=this;this.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()({type:"friend_list"})),setTimeout(function(){e.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()({type:"user_list",online:1}))},500)},connectWs:function(){var e=this;-1==this.wsStatus&&(this.ws=new WebSocket(wsUrl),this.ws.onopen=function(){if(e.wsStatus=10,__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default()(e.userInfo).length>0){var s={type:"login",name:e.userInfo.name};e.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(s)),setTimeout(function(){e.afterLogin()},500)}},this.ws.onmessage=this.wsMsg,this.ws.onclose=function(){console.debug("onclose..."),e.wsStatus=-1}),setTimeout(this.connectWs,3e3)},actionMain:function(e,s){switch(e){case"memberSearch":this.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()({type:"user_list"})),this.memberSearch.show=!0;break;case"delConversation":this.user.group?this.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()({type:"leave_group",from:this.userInfo.name,group_name:this.user.name})):this.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()({type:"del_friend",from:this.userInfo.name,name:this.user.name})),this.usersList.splice(this.userIndex,1),this.userIndex=-1}},memberSearchSelected:function(e){for(var s in this.memberSearch.selected=[],e)this.memberSearch.selected.push(e[s].name)},memberSearchOk:function(){if(0!=this.memberSearch.selected.length){var e="",s=!0;if(this.user.group)e=this.user.name,s=!1;else{if(""==this.memberSearch.group_name)return void this.$Message.error("请填写群名称!");this.memberSearch.selected.push(this.user.name),this.memberSearch.selected.push(this.userInfo.name),e=this.memberSearch.group_name,this.memberSearch.group_name=""}var t={type:"join_group",create:s,from:this.userInfo.name,group_name:e,users:this.memberSearch.selected};this.ws.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(t))}}},created:function created(){var _this3=this,vthis=this,user=sessionStorage.getItem("user");null!=user&&(this.userInfo=eval("("+user+")")),this.connectWs(),setInterval(function(){""==_this3.notification.title&&(_this3.notification.title=document.querySelector("title").innerHTML),0!=_this3.usersList.filter(function(e){return e.unread>0}).length?_this3.notification.trigger?(document.querySelector("title").innerHTML="【新消息】 - "+_this3.notification.title,_this3.notification.trigger=!1):(document.querySelector("title").innerHTML="【　　　】 - "+_this3.notification.title,_this3.notification.trigger=!0):document.querySelector("title").innerHTML=_this3.notification.title},500)},watch:{},computed:{ws_status:function(){return 10!=this.wsStatus}},data:function(){var e=this;return{ws:"",wsStatus:-1,formLogin:{user:"",password:"",rule:{user:[{required:!0,message:"请填写用户名",trigger:"blur"}],password:[{required:!0,message:"请填写密码",trigger:"blur"},{type:"string",min:6,message:"密码最少6位",trigger:"blur"}]}},formPasswd:{show:!1,passwd:"",passwd2:"",rule:{passwd:[{required:!0,message:"请填写旧密码",trigger:"blur"}],passwd2:[{required:!0,message:"请填写新密码",trigger:"blur"},{type:"string",min:6,message:"密码最少6位",trigger:"blur"}]}},userInfo:{},allUsersList:[],usersList:[],user:{},userIndex:-1,memberManage:{show:!1,columns:[{title:"用户名",key:"name"},{title:"操作",key:"act",render:function(s,t){return s("div",[s("Button",{style:{marginLeft:"5px"},props:{type:"error",size:"small"},on:{click:function(){e.formLogin.user=t.row.name}}},"密码修改")])}}],data:[{name:"loading..."}]},memberSearch:{show:!1,columns:[{type:"selection",width:80},{title:"用户名",key:"name"}],data:[{name:"loading..."}],group_name:"",selected:[]},notification:{trigger:!0,title:""}}}}},z1pM:function(e,s){}},["NHnr"]);
//# sourceMappingURL=app.a789a57bd3b53e7cb932.js.map